---
// Import the required modules
import { Image } from "astro:assets";

// Extract properties from Astro.props
const {
  imgOne,
  imgOneAlt,
  imgTwo,
  imgTwoAlt,
  imgThree,
  imgThreeAlt,
  imgFour,
  imgFourAlt,
} = Astro.props;

// Define TypeScript interface for the properties
interface Props {
  imgOne: any;
  imgOneAlt: string;
  imgTwo: any;
  imgTwoAlt: string;
  imgThree: any;
  imgThreeAlt: string;
  imgFour: any;
  imgFourAlt: string;
}
---

<!-- Root section of the component -->
<section class="w-full px-4 py-8 sm:px-6 lg:px-8" id="four-image-section">
  <div class="mx-auto max-w-[90rem] 2xl:max-w-full">
         <!-- Four image layout in a single row with staggered heights -->
     <div class=" grid grid-cols-3 md:grid-cols-4 gap-2 md:gap-4">
       <!-- First image -->
       <Image
         class="w-full h-48 md:h-80 lg:h-96 object-cover"
         src={imgOne}
         alt={imgOneAlt}
         draggable="false"
         format="avif"
         id="four-img-1"
       />
       
       <!-- Second image (higher) -->
       <Image
         class="mt-2 md:mt-4 w-full h-48 md:h-80 lg:h-96 object-cover lg:mt-10"
         src={imgTwo}
         alt={imgTwoAlt}
         draggable="false"
         format="avif"
         id="four-img-2"
       />
       
       <!-- Third image -->
       <Image
         class="w-full h-48 md:h-80 lg:h-96 object-cover"
         src={imgThree}
         alt={imgThreeAlt}
         draggable="false"
         format="avif"
         id="four-img-3"
       />
       
       <!-- Fourth image (higher) - hidden on mobile -->
       <Image
         class="hidden md:block mt-2 md:mt-4 w-full h-48 md:h-80 lg:h-96 object-cover lg:mt-10"
         src={imgFour}
         alt={imgFourAlt}
         draggable="false"
         format="avif"
         id="four-img-4"
       />
     </div>
  </div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  
  // Register ScrollTrigger plugin
  gsap.registerPlugin(ScrollTrigger);
  
  // Function to initialize the four image animations
  function initFourImageAnimations() {
    console.log('FourImageSection script loaded');
    
    const section = document.getElementById('four-image-section');
    const images = [
      document.getElementById('four-img-1'),
      document.getElementById('four-img-2'),
      document.getElementById('four-img-3'),
      document.getElementById('four-img-4')
    ];
    
    if (!section) {
      console.error('Four image section not found');
      return;
    }
    
    // Filter out null elements (like the 4th image on mobile)
    const validImages = images.filter(img => img !== null);
    
    console.log('Found valid images:', validImages.length);
    
    // Set initial state - images start slightly below their final position
    gsap.set(validImages, { 
      y: 30, 
      opacity: 0.7 
    });
    
    // Create timeline for the animations
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: section,
        start: "top 80%",
        end: "bottom 20%",
        toggleActions: "play none none reverse"
      }
    });
    
    // Animate each image with stagger
    tl.to(validImages, {
      y: 0,
      opacity: 1,
      duration: 1.2,
      ease: "power2.out",
      stagger: 0.15 // Stagger each image by 0.15 seconds
    });
    
    console.log('Four image vertical animation timeline created');
    
    return tl;
  }
  
  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFourImageAnimations);
  } else {
    initFourImageAnimations();
  }
  
  // Cleanup function for Astro
  document.addEventListener('astro:page-load', () => {
    // Kill any existing ScrollTriggers
    ScrollTrigger.getAll().forEach(trigger => trigger.kill());
    // Initialize new animations
    initFourImageAnimations();
  });
  
  document.addEventListener('astro:before-swap', () => {
    // Cleanup before page swap
    ScrollTrigger.getAll().forEach(trigger => trigger.kill());
  });
</script>
